<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Spanish Origin-Destination Data • spanishoddata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Get Spanish Origin-Destination Data">
<meta name="description" content="Gain seamless access to origin-destination (OD) data from the Spanish Ministry of Transport, hosted at &lt;https://www.transportes.gob.es/ministerio/proyectos-singulares/estudios-de-movilidad-con-big-data/opendata-movilidad&gt;. This package simplifies the management of these large datasets by providing tools to download zone boundaries, handle associated origin-destination data, and process it efficiently with the duckdb database interface. Local caching minimizes repeated downloads, streamlining workflows for researchers and analysts. Extensive documentation is available at &lt;https://ropenspain.github.io/spanishoddata/index.html&gt;, offering guides on creating static and dynamic mobility flow visualizations and transforming large datasets into analysis-ready formats.">
<meta property="og:description" content="Gain seamless access to origin-destination (OD) data from the Spanish Ministry of Transport, hosted at &lt;https://www.transportes.gob.es/ministerio/proyectos-singulares/estudios-de-movilidad-con-big-data/opendata-movilidad&gt;. This package simplifies the management of these large datasets by providing tools to download zone boundaries, handle associated origin-destination data, and process it efficiently with the duckdb database interface. Local caching minimizes repeated downloads, streamlining workflows for researchers and analysts. Extensive documentation is available at &lt;https://ropenspain.github.io/spanishoddata/index.html&gt;, offering guides on creating static and dynamic mobility flow visualizations and transforming large datasets into analysis-ready formats.">
<meta property="og:image" content="https://rOpenSpain.github.io/spanishoddata/reference/figures/card.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenSpain">
<meta name="twitter:site" content="@rOpenSpain">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="BS5/rostemplate.min.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
  <a class="navbar-brand me-2" href="index.html">
    <img src="apple-touch-icon-180x180.png" alt="spanishoddata logo" height="40" class="d-inline-block me-1">spanishoddata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/v1-2020-2021-mitma-data-codebook.html">Codebook and cookbook for v1 (2020-2021) Spanish mobility data</a></li>
    <li><a class="dropdown-item" href="articles/v2-2022-onwards-mitma-data-codebook.html">Codebook and cookbook for v2 (2022 onwards) Spanish mobility data</a></li>
    <li><a class="dropdown-item" href="articles/quick-get.html">Quicky get daily data</a></li>
    <li><a class="dropdown-item" href="articles/convert.html">Download and convert mobility datasets</a></li>
    <li><a class="dropdown-item" href="articles/disaggregation.html">OD data disaggregation</a></li>
    <li><a class="dropdown-item" href="articles/flowmaps-static.html">Making static flow maps</a></li>
    <li><a class="dropdown-item" href="articles/flowmaps-interactive.html">Making interactive flow maps</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rOpenSpain/spanishoddata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="spanishoddata-get-spanish-origin-destination-data-">spanishoddata: Get Spanish Origin-Destination Data 
<a class="anchor" aria-label="anchor" href="#spanishoddata-get-spanish-origin-destination-data-"></a>
</h1>
</div>
<!-- badges: start -->

<p><strong>spanishoddata</strong> is an R package that provides functions for downloading and formatting Spanish open mobility data released by the Ministry of Transport and Sustainable Mobility of Spain (MITMS 2024).</p>
<p>It supports the two versions of the Spanish mobility data that consists of origin-destination matrices and some additional data sets. <a href="https://www.transportes.gob.es/ministerio/proyectos-singulares/estudios-de-movilidad-con-big-data/estudios-de-movilidad-anteriores/covid-19/opendata-movilidad" class="external-link">The first version</a> covers data from 2020 and 2021, including the period of the COVID-19 pandemic. <a href="https://www.transportes.gob.es/ministerio/proyectos-singulares/estudios-de-movilidad-con-big-data/opendata-movilidad" class="external-link">The second version</a> contains data from January 2022 onwards and is regularly updated. Both versions of the data primarily consist of mobile phone positioning data, and include matrices for overnight stays, individual movements, and trips of Spanish residents at different geographical levels. See the <a href="https://rOpenSpain.github.io/spanishoddata/">package website</a> and vignettes for <a href="https://rOpenSpain.github.io/spanishoddata/articles/v1-2020-2021-mitma-data-codebook">v1</a> and <a href="https://rOpenSpain.github.io/spanishoddata/articles/v2-2022-onwards-mitma-data-codebook">v2</a> data for more details.</p>
<p><strong>spanishoddata</strong> is designed to save time by providing the data in analysis-ready formats. Automating the process of downloading, cleaning, and importing the data can also reduce the risk of errors in the laborious process of data preparation. It also reduces computational resources by using computationally efficient packages behind the scenes. To effectively work with multiple data files, it’s recommended you set up a data directory where the package can search for the data and download only the files that are not already present.</p>
</div>
<div class="section level1">
<h1 id="examples-of-available-data">Examples of available data<a class="anchor" aria-label="anchor" href="#examples-of-available-data"></a>
</h1>
<div id="fig-barcelona-flows">
<p><img src="articles/media/flows_plot.svg"></p>
<p>Figure 1: Example of the data available through the package: daily flows in Barcelona</p>
</div>
<p>To create static maps like that see our vignette <a href="https://ropenspain.github.io/spanishoddata/articles/flowmaps-static.html" class="external-link">here</a>.</p>
<hr>
<div id="fig-spain-flows">
<p><img src="https://ropenspain.github.io/spanishoddata/media/spain-folding-flows.gif"></p>
<p>Figure 2: Example of the data available through the package: interactive daily flows in Spain</p>
</div>
<div id="fig-spain-flows">
<p><img src="https://ropenspain.github.io/spanishoddata/media/barcelona-time.gif"></p>
<p>Figure 3: Example of the data available through the package: interactive daily flows in Barcelona with time filter</p>
</div>
<p>To create interactive maps see our vignette <a href="https://ropenspain.github.io/spanishoddata/articles/flowmaps-interactive.html" class="external-link">here</a>.</p>
<div class="section level2">
<h2 id="install-the-package">Install the package<a class="anchor" aria-label="anchor" href="#install-the-package"></a>
</h2>
<p>The package is not yet available on CRAN.</p>
<p>You can install the latest version of the package from rOpenSpain R universe:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spanishoddata"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://ropenspain.r-universe.dev"</span>,</span>
<span>    <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<details><summary>
Alternative installation and developemnt
</summary><p>Alternative way to install the package from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">"remotes"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rOpenSpain/spanishoddata"</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">TRUE</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>For Developers</strong></p>
<p>To load the package locally, clone it and navigate to the root of the package in the terminal, e.g. with the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">gh</span> repo clone rOpenSpain/spanishoddata</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">code</span> spanishoddata</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># with rstudio:</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">rstudio</span> spanishoddata/spanishoddata.Rproj</span></code></pre></div>
<p>Then run the following command from the R console:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details><p>Load it as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rOpenSpain.github.io/spanishoddata/">spanishoddata</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-the-data-directory">Set the data directory<a class="anchor" aria-label="anchor" href="#set-the-data-directory"></a>
</h2>
<p>Choose where <a href="https://rOpenSpain.github.io/spanishoddata/">spanishoddata</a> should download (and convert) the data by setting the data directory following command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/spod_set_data_dir.html">spod_set_data_dir</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="st">"~/spanish_od_data"</span><span class="op">)</span></span></code></pre></div>
<p>The function above will also ensure that the directory is created and that you have sufficient permissions to write to it.</p>
<details><summary>
Setting data directory for advanced users
</summary><p>You can also set the data directory with an environment variable:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>SPANISH_OD_DATA_DIR <span class="op">=</span> <span class="st">"~/spanish_od_data"</span><span class="op">)</span></span></code></pre></div>
<p>The package will create this directory if it does not exist on the first run of any function that downloads the data.</p>
<p>To permanently set the directory for all projects, you can specify the data directory globally by setting the <code>SPANISH_OD_DATA_DIR</code> environment variable, e.g. with the following command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_environ</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Then set the data directory globally, by typing this line in the file:</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>SPANISH_OD_DATA_DIR <span class="ot">=</span> <span class="st">"~/spanish_od_data"</span></span></code></pre></div>
<p>You can also set the data directory locally, just for the current project. Set the ‘envar’ in the working directory by editing <code>.Renviron</code> file in the root of the project:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="st">".Renviron"</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</div>
<div class="section level1">
<h1 id="overall-approach-to-accessing-the-data">Overall approach to accessing the data<a class="anchor" aria-label="anchor" href="#overall-approach-to-accessing-the-data"></a>
</h1>
<p>If you only need flows data aggregated by day at municipal level, you can use the <code><a href="reference/spod_quick_get_od.html">spod_quick_get_od()</a></code> function. This will download the data directly from the web API and let you analyse it in-memory. More on this in the <a href="https://ropenspain.github.io/spanishoddata/articles/quick-get.html" class="external-link">Quickly get daily data</a> vignette.</p>
<p>If you only want to analyse the data for a few days, you can use the <code><a href="reference/spod_get.html">spod_get()</a></code> function. It will download the raw data in CSV format and let you analyse it in-memory. This is what we cover in the steps on this page.</p>
<p>If you need longer periods (several months or years), you should use the <code><a href="reference/spod_convert.html">spod_convert()</a></code> and <code><a href="reference/spod_connect.html">spod_connect()</a></code> functions, which will convert the data into special format which is much faster for analysis, for this see the <a href="https://ropenspain.github.io/spanishoddata/articles/convert.html" class="external-link">Download and convert OD datasets</a> vignette. <code><a href="reference/spod_get_zones.html">spod_get_zones()</a></code> will give you spatial data with zones that can be matched with the origin-destination flows from the functions above using zones ’id’s. Please see a simple example below, and also consult the vignettes with detailed data description and instructions in the package vignettes with <code>spod_codebook(ver = 1)</code> and <code>spod_codebook(ver = 2)</code>, or simply visit the package website at <a href="https://ropenspain.github.io/spanishoddata/" class="external-link uri">https://ropenspain.github.io/spanishoddata/</a>. The <a href="#fig-overall-flow" class="quarto-xref">Figure 4</a> presents the overall approach to accessing the data in the <code>spanishoddata</code> package.</p>
<div id="fig-overall-flow">
<p><img src="reference/figures/package-functions-overview.svg" style="width:78.0%"></p>
<p>Figure 4: The overview of package functions to get the data</p>
</div>
</div>
<div class="section level1">
<h1 id="showcase">Showcase<a class="anchor" aria-label="anchor" href="#showcase"></a>
</h1>
<p>To run the code in this README we will use the following setup:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Get metadata for the datasets as follows (we are using version 2 data covering years 2022 and onwards):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/spod_available_data.html">spod_available_data</a></span><span class="op">(</span>ver <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># for version 2 of the data</span></span>
<span><span class="va">metadata</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># A tibble: 9,442 × 6</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>   target_url           pub_ts              file_extension data_ym data_ymd  </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                <span class="er">&lt;</span>dttm<span class="sc">&gt;</span>              <span class="er">&lt;</span>chr<span class="sc">&gt;</span>          <span class="er">&lt;</span>date<span class="sc">&gt;</span>  <span class="er">&lt;</span>date<span class="sc">&gt;</span>    </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a> <span class="dv">1</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">54</span><span class="sc">:</span><span class="dv">08</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-23</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a> <span class="dv">2</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">51</span><span class="sc">:</span><span class="dv">07</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-22</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a> <span class="dv">3</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">47</span><span class="sc">:</span><span class="dv">52</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-20</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a> <span class="dv">4</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">14</span><span class="sc">:</span><span class="dv">55</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-18</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a> <span class="dv">5</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">11</span><span class="sc">:</span><span class="dv">58</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-17</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a> <span class="dv">6</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">09</span><span class="sc">:</span><span class="dv">03</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-12</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a> <span class="dv">7</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">05</span><span class="sc">:</span><span class="dv">57</span> gz             <span class="cn">NA</span>      <span class="dv">2022-10-07</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a> <span class="dv">8</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">02</span><span class="sc">:</span><span class="dv">12</span> gz             <span class="cn">NA</span>      <span class="dv">2022-08-07</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a> <span class="dv">9</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">09</span><span class="sc">:</span><span class="dv">58</span><span class="sc">:</span><span class="dv">34</span> gz             <span class="cn">NA</span>      <span class="dv">2022-08-06</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="dv">10</span> https<span class="sc">:</span><span class="er">//</span>movilidad<span class="sc">-</span>o… <span class="dv">2024-07-30</span> <span class="dv">09</span><span class="sc">:</span><span class="dv">54</span><span class="sc">:</span><span class="dv">30</span> gz             <span class="cn">NA</span>      <span class="dv">2022-08-05</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co"># ℹ 9,432 more rows</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co"># ℹ 1 more variable: local_path &lt;chr&gt;</span></span></code></pre></div>
<div class="section level2">
<h2 id="zones">Zones<a class="anchor" aria-label="anchor" href="#zones"></a>
</h2>
<p>Zones can be downloaded as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distritos</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/spod_get_zones.html">spod_get_zones</a></span><span class="op">(</span><span class="st">"distritos"</span>, ver <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">distritos_wgs84</span> <span class="op">&lt;-</span> <span class="va">distritos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_simplify</a></span><span class="op">(</span>dTolerance <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">distritos_wgs84</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-distritos-1.png"></p>
</div>
<div class="section level2">
<h2 id="od-data">OD data<a class="anchor" aria-label="anchor" href="#od-data"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/spod_get.html">spod_get</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"origin-destination"</span>,</span>
<span>  zones <span class="op">=</span> <span class="st">"districts"</span>,</span>
<span>  dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>start <span class="op">=</span> <span class="st">"2024-03-01"</span>, end <span class="op">=</span> <span class="st">"2024-03-07"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">od_db</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"tbl_duckdb_connection"</span> <span class="st">"tbl_dbi"</span>               <span class="st">"tbl_sql"</span>              </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>[<span class="dv">4</span>] <span class="st">"tbl_lazy"</span>              <span class="st">"tbl"</span>                  </span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">od_db</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"full_date"</span>                   <span class="st">"time_slot"</span>                  </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a> [<span class="dv">3</span>] <span class="st">"id_origin"</span>                   <span class="st">"id_destination"</span>             </span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">"distance"</span>                    <span class="st">"activity_origin"</span>            </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">"activity_destination"</span>        <span class="st">"study_possible_origin"</span>      </span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">"study_possible_destination"</span>  <span class="st">"residence_province_ine_code"</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">"residence_province"</span>          <span class="st">"income"</span>                     </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">"age"</span>                         <span class="st">"sex"</span>                        </span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">"n_trips"</span>                     <span class="st">"trips_total_length_km"</span>      </span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">"year"</span>                        <span class="st">"month"</span>                      </span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">"day"</span>                        </span></code></pre></div>
<p>The result is an R database interface object (<code>tbl_dbi</code>) that can be used with dplyr functions and SQL queries ‘lazily’, meaning that the data is not loaded into memory until it is needed. Let’s do an aggregation to find the total number trips per hour over the 7 days:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_per_hour</span> <span class="op">&lt;-</span> <span class="va">od_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">time_slot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, Trips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_trips</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_h</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">time_slot</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Day <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">Time</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_per_hour</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">Day</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of trips per hour over 7 days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-trips-per-hour-1.png"></p>
<p>The figure above summarises 925,874,012 trips over the 7 days associated with 135,866,524 records.</p>
</div>
<div class="section level2">
<h2 id="spanishoddata-advantage-over-accessing-the-data-yourself">
<code>spanishoddata</code> advantage over accessing the data yourself<a class="anchor" aria-label="anchor" href="#spanishoddata-advantage-over-accessing-the-data-yourself"></a>
</h2>
<p>As we demonstrated above, you can perform very quick analysis using just a few lines of code.</p>
<p>To highlight the benefits of the package, here is how you would do this manually:</p>
<ul>
<li><p>download the <a href="https://movilidad-opendata.mitma.es/RSS.xml" class="external-link">xml</a> file with the download links</p></li>
<li><p>parse this xml to extract the download links</p></li>
<li><p>write a script to download the files and locate them on disk in a logical manner</p></li>
<li><p>figure out the data structure of the downloaded files, read the codebook</p></li>
<li><p>translate the data (columns and values) into English, if you are not familiar with Spanish</p></li>
<li><p>write a script to load the data into the database or figure out a way to claculate summaries on multiple files</p></li>
<li><p>and much more…</p></li>
</ul>
<p>We did all of that for you and present you with a few simple functions that get you straight to the data in one line of code, and you are ready to run any analysis on it.</p>
</div>
</div>
<div class="section level1">
<h1 id="desire-lines">Desire lines<a class="anchor" aria-label="anchor" href="#desire-lines"></a>
</h1>
<p>We’ll use the same input data to pick-out the most important flows in Spain, with a focus on longer trips for visualisation:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_national_aggregated</span> <span class="op">&lt;-</span> <span class="va">od_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_origin</span>, <span class="va">id_destination</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Trips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_trips</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trips</span> <span class="op">&gt;</span> <span class="fl">500</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Trips</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">od_national_aggregated</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># A tibble: 96,404 × 3</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>   id_origin id_destination    Trips</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>   <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>     <span class="er">&lt;</span>fct<span class="sc">&gt;</span>             <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a> <span class="dv">1</span> <span class="dv">2807908</span>   <span class="dv">2807908</span>        <span class="fl">2441404.</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a> <span class="dv">2</span> <span class="dv">0801910</span>   <span class="dv">0801910</span>        <span class="fl">2112188.</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a> <span class="dv">3</span> <span class="dv">0801902</span>   <span class="dv">0801902</span>        <span class="fl">2013618.</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a> <span class="dv">4</span> <span class="dv">2807916</span>   <span class="dv">2807916</span>        <span class="fl">1821504.</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a> <span class="dv">5</span> <span class="dv">2807911</span>   <span class="dv">2807911</span>        <span class="fl">1785981.</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a> <span class="dv">6</span> <span class="dv">04902</span>     <span class="dv">04902</span>          <span class="fl">1690606.</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a> <span class="dv">7</span> <span class="dv">2807913</span>   <span class="dv">2807913</span>        <span class="fl">1504484.</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a> <span class="dv">8</span> <span class="dv">2807910</span>   <span class="dv">2807910</span>        <span class="fl">1299586.</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a> <span class="dv">9</span> <span class="dv">0704004</span>   <span class="dv">0704004</span>        <span class="fl">1287122.</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="dv">10</span> <span class="dv">28106</span>     <span class="dv">28106</span>          <span class="fl">1286058.</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co"># ℹ 96,394 more rows</span></span></code></pre></div>
<p>The results show that the largest flows are intra-zonal. Let’s keep only the inter-zonal flows:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_national_interzonal</span> <span class="op">&lt;-</span> <span class="va">od_national_aggregated</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_origin</span> <span class="op">!=</span> <span class="va">id_destination</span><span class="op">)</span></span></code></pre></div>
<p>We can convert these to geographic data with the {od} package (Lovelace and Morgan 2024):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_national_sf</span> <span class="op">&lt;-</span> <span class="fu">od</span><span class="fu">::</span><span class="fu">od_to_sf</span><span class="op">(</span></span>
<span>  <span class="va">od_national_interzonal</span>,</span>
<span>  z <span class="op">=</span> <span class="va">distritos_wgs84</span></span>
<span><span class="op">)</span></span>
<span><span class="va">distritos_wgs84</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">spData</span><span class="fu">::</span><span class="va">world</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"blue"</span>, data <span class="op">=</span> <span class="va">od_national_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-desire-lines-1.png"></p>
<p>Let’s focus on trips in and around a particular area (Salamanca):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salamanca_zones</span> <span class="op">&lt;-</span> <span class="fu">zonebuilder</span><span class="fu">::</span><span class="fu">zb_zone</span><span class="op">(</span><span class="st">"Salamanca"</span><span class="op">)</span></span>
<span><span class="va">distritos_salamanca</span> <span class="op">&lt;-</span> <span class="va">distritos_wgs84</span><span class="op">[</span><span class="va">salamanca_zones</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distritos_salamanca</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-salamanca-zones-1.png"></p>
<p>We will use this information to subset the rows, to capture all movement within the study area:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ids_salamanca</span> <span class="op">&lt;-</span> <span class="va">distritos_salamanca</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="va">od_salamanca</span> <span class="op">&lt;-</span> <span class="va">od_national_sf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_origin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids_salamanca</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_destination</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids_salamanca</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Trips</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot the results:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_salamanca_sf</span> <span class="op">&lt;-</span> <span class="fu">od</span><span class="fu">::</span><span class="fu">od_to_sf</span><span class="op">(</span></span>
<span>  <span class="va">od_salamanca</span>,</span>
<span>  z <span class="op">=</span> <span class="va">distritos_salamanca</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span>, data <span class="op">=</span> <span class="va">distritos_salamanca</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">od_salamanca_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-salamanca-plot-1.png"></p>
</div>
<div class="section level1">
<h1 id="further-information">Further information<a class="anchor" aria-label="anchor" href="#further-information"></a>
</h1>
<p>For more information on the package, see:</p>
<ul>
<li>The <a href="https://rOpenSpain.github.io/spanishoddata/">pkgdown site</a>
<ul>
<li><a href="https://rOpenSpain.github.io/spanishoddata/reference/index.html">Functions reference</a></li>
<li><a href="https://rOpenSpain.github.io/spanishoddata/articles/v1-2020-2021-mitma-data-codebook.html">v1 data (2020-2021) codebook</a></li>
<li><a href="https://rOpenSpain.github.io/spanishoddata/articles/v2-2022-onwards-mitma-data-codebook.html">v2 data (2022 onwards) codebook (work in progress)</a></li>
<li><a href="https://rOpenSpain.github.io/spanishoddata/articles/convert.html">Download and convert data</a></li>
<li>The <a href="https://rOpenSpain.github.io/spanishoddata/articles/disaggregation.html">OD disaggregation vignette</a> showcases flows disaggregation</li>
<li>
<a href="https://rOpenSpain.github.io/spanishoddata/articles/flowmaps-static.html">Making static flowmaps</a> vignette shows how to create flowmaps using the data acquired with <a href="https://rOpenSpain.github.io/spanishoddata/">spanishoddata</a>
</li>
<li>
<a href="https://rOpenSpain.github.io/spanishoddata/articles/flowmaps-interactive.html">Making interactive flowmaps</a> shows how to create an interactive flowmap using the data acquired with <a href="https://rOpenSpain.github.io/spanishoddata/">spanishoddata</a>
</li>
<li><a href="https://ropenspain.github.io/spanishoddata/articles/quick-get.html" class="external-link">Quickly getting daily aggregated 2022+ data at municipality level</a></li>
</ul>
</li>
</ul>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>To cite spanishoddata R package and data in publications use:</p>
<p>Kotov E, Lovelace R, Vidal-Tortosa E (2024). <em>spanishoddata</em>. <a href="doi:10.32614/CRAN.package.spanishoddata" class="uri">doi:10.32614/CRAN.package.spanishoddata</a> <a href="https://doi.org/10.32614/CRAN.package.spanishoddata" class="external-link uri">https://doi.org/10.32614/CRAN.package.spanishoddata</a>, <a href="https://github.com/rOpenSpain/spanishoddata" class="external-link uri">https://github.com/rOpenSpain/spanishoddata</a>.</p>
<p>MITMS (2024). “Estudio de movilidad de viajeros de ámbito nacional aplicando la tecnología Big Data. Informe metodológico (Study of National Traveler mobility Using Big Data Technology. Methodological Report).” Secretaría de Estado de Transportes y Movilidad Sostenible; Ministerio de Transportes, Movilidad y Agenda Urbana. <a href="https://www.transportes.gob.es/ministerio/proyectos-singulares/estudio-de-movilidad-con-big-data" class="external-link uri">https://www.transportes.gob.es/ministerio/proyectos-singulares/estudio-de-movilidad-con-big-data</a>.</p>
<p>BibTeX:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="sc">@</span>Manual{spanishoddata,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  title <span class="ot">=</span> {spanishoddata},</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  author <span class="ot">=</span> {Egor Kotov and Robin Lovelace and Eugeni Vidal<span class="sc">-</span>Tortosa},</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  year <span class="ot">=</span> {<span class="dv">2024</span>},</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  url <span class="ot">=</span> {https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>rOpenSpain<span class="sc">/</span>spanishoddata},</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>  doi <span class="ot">=</span> {<span class="fl">10.32614</span><span class="sc">/</span>CRAN.package.spanishoddata},</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>}</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="sc">@</span>TechReport{mitma_mobility_2024_v8,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  title <span class="ot">=</span> {Estudio de movilidad de viajeros de ámbito nacional aplicando la tecnología Big Data. Informe metodológico (Study of National Traveler mobility Using Big Data Technology. Methodological Report)},</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  author <span class="ot">=</span> {{MITMS}},</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>  institution <span class="ot">=</span> {Secretaría de Estado de Transportes y Movilidad Sostenible; Ministerio de Transportes, Movilidad y Agenda Urbana},</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  year <span class="ot">=</span> {<span class="dv">2024</span>},</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>  url <span class="ot">=</span> {https<span class="sc">:</span><span class="er">//</span>www.transportes.gob.es<span class="sc">/</span>ministerio<span class="sc">/</span>proyectos<span class="sc">-</span>singulares<span class="sc">/</span>estudio<span class="sc">-</span>de<span class="sc">-</span>movilidad<span class="sc">-</span>con<span class="sc">-</span>big<span class="sc">-</span>data},</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>  urldate <span class="ot">=</span> {<span class="dv">2024-12-11</span>},</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>  annotation <span class="ot">=</span> {https<span class="sc">:</span><span class="er">//</span>www.transportes.gob.es<span class="sc">/</span>recursos_mfom<span class="sc">/</span>paginabasica<span class="sc">/</span>recursos<span class="sc">/</span>a3_informe_metodologico_estudio_movilidad_mitms_v8.pdf},</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h1>
<!-- metadata for better search engine indexing -->
<!-- should be picked up by pkgdown -->
<!-- update metadata before release with  -->
<!-- cffr::cff_write() -->
<!-- codemetar::write_codemeta(write_minimeta = T) -->
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-lovelace_od_2024" class="csl-entry">
Lovelace, Robin, and Malcolm Morgan. 2024. “Od: Manipulate and Map Origin-Destination Data,” August. <a href="https://doi.org/10.32614/CRAN.package.od" class="external-link uri">https://doi.org/10.32614/CRAN.package.od</a>.
</div>
<div id="ref-mitma_mobility_2024_v8" class="csl-entry">
MITMS. 2024. “Estudio de Movilidad de Viajeros de Ámbito Nacional Aplicando La Tecnología Big Data. Informe Metodológico (Study of National Traveler Mobility Using Big Data Technology. Methodological Report).” Secretaría de Estado de Transportes y Movilidad Sostenible; Ministerio de Transportes, Movilidad y Agenda Urbana. <a href="https://www.transportes.gob.es/ministerio/proyectos-singulares/estudio-de-movilidad-con-big-data" class="external-link uri">https://www.transportes.gob.es/ministerio/proyectos-singulares/estudio-de-movilidad-con-big-data</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/rOpenSpain/spanishoddata/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/rOpenSpain/spanishoddata/issues" class="external-link">Report a bug</a></li>
<li><a href="https://ropenspain.es/" class="external-link">About <img src="ROS-logo.png" alt="rOpenSpain-Logo" height="24" style="display: inline;"> rOpenSpain</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing spanishoddata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.ekotov.pro" class="external-link">Egor Kotov</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6690-5345" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.robinlovelace.net/" class="external-link">Robin Lovelace</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-5679-6536" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" target="_blank" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://CRAN.R-project.org/package=spanishoddata" target="_blank" class="external-link"><img src="https://www.r-pkg.org/badges/version/spanishoddata.png" alt="CRAN status"></a></li>
<li><a href="https://CRAN.R-project.org/package=spanishoddata" target="_blank" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/spanishoddata?color=blue.png" alt="CRAN/METACRAN Total downloads"></a></li>
<li><a href="https://CRAN.R-project.org/package=spanishoddata" target="_blank" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/spanishoddata?color=blue.png" alt="CRAN/METACRAN Downloads per month"></a></li>
<li><a href="https://github.com/rOpenSpain/spanishoddata/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/rOpenSpain/spanishoddata/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://doi.org/10.32614/CRAN.package.spanishoddata" class="external-link"><img src="https://zenodo.org/badge/DOI/10.32614/CRAN.package.spanishoddata.svg" alt="DOI"></a></li>
<li><a href="https://doi.org/10.5281/zenodo.14516104" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.14516104.svg" alt="DOI"></a></li>
</ul>
</div>

  </aside>
</div>

<script>
  var homeall = document.getElementsByTagName("h1");
  var banner = document.createElement('div');
  banner.innerHTML = '<a href="https://ropenspain.es/" id="ROS-heading-breadcrumbs">' +
        '<div class="text-center" id="ROS-partof">' +
          '<p>Part of <img src="ROS-logo.png" alt="rOpenSpain-Logo" id="homelogoxs"> rOpenSpain </p>' +
        '</div></a>'
  if (homeall.length > 0) {
	  home = homeall[0];
	  home.insertBefore(banner,home.firstChild);
  }
</script>
</div>

  <!-- ropenspain rostemplate -->
<footer id="footer"><div class="container">
    <div class="row">
      <div class="col-md">
        <h4 data-toc-skip>About <img src="logo.png" alt="spanishoddata Logo" height="24"> spanishoddata</h4>
        <p>Developed by <a href="https://www.ekotov.pro" class="external-link">Egor Kotov</a>, <a href="https://www.robinlovelace.net/" class="external-link">Robin Lovelace</a>.</p>
        <p>Part of the <span class="ROS-light">rOpenSpain</span> project.</p>
        <hr class="d-md-none">
</div>
      <div class="col-md offset-md-4">
        <h4 data-toc-skip>About <img src="ROS-logo.png" alt="ROpenSpain Logo" height="24"><span class="ROS-light"> rOpenSpain</span>
</h4>
        <a href="https://ropenspain.es/" class="external-link"><span class="ROS-light">rOpenSpain</span></a> is a community of R enthusiasts whose ultimate goal is to create high-quality R packages for data mining public Spanish open sources.
        <hr class="d-md-none">
</div>
   </div>
  </div>
</footer><div id="copyright">
  <div class="container">
    <div class="row">
      <div class="col-md text-center text-lg-start">
        <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
      </div>
      <div class="col-md offset-md-4 text-center text-lg-start">
      <p>Template <a href="https://github.com/ropenspain/rostemplate/" class="external-link">rostemplate</a> by <a href="https://github.com/dieghernan/" class="external-link">dieghernan</a>, based on <a href="https://bootstrapious.com/" class="external-link">Bootstrapious</a>.
      </p>
      </div>
    </div>
  </div>
</div>




  <script>
var h1s = document.getElementsByTagName("h1");
var myH1;
if (h1s.length > 0) {
  myH1 = h1s[0];
  myH1.classList.add("ROSh1");
}
</script>
</body>
</html>
